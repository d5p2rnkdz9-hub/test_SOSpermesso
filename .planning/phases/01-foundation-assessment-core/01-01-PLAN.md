---
phase: 01-foundation-assessment-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - tailwind.config.ts
  - next.config.ts
  - .env.local
  - .env.example
  - prisma/schema.prisma
  - src/lib/db.ts
  - src/types/quiz.ts
autonomous: true

must_haves:
  truths:
    - "Next.js project runs with npm run dev"
    - "Database connection established"
    - "Schema supports multiple question types"
    - "TypeScript types match database schema"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "next"
    - path: "prisma/schema.prisma"
      provides: "Database models"
      contains: "model Question"
    - path: "src/types/quiz.ts"
      provides: "TypeScript types"
      exports: ["Question", "QuestionType", "Answer", "Session"]
    - path: "src/lib/db.ts"
      provides: "Prisma client singleton"
      exports: ["prisma"]
  key_links:
    - from: "src/lib/db.ts"
      to: "prisma/schema.prisma"
      via: "Prisma client generation"
      pattern: "PrismaClient"
---

<objective>
Initialize Next.js project with Supabase/Prisma database, schema for questionnaire data, and TypeScript types.

Purpose: Foundation for all subsequent plans. Database schema must be flexible (JSONB) to support multiple question types without rigid columns.

Output: Running Next.js app with connected database and deployed schema.
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-assessment-core/01-CONTEXT.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js project with dependencies</name>
  <files>
    package.json
    tsconfig.json
    tailwind.config.ts
    next.config.ts
    .env.local
    .env.example
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
  </files>
  <action>
Create Next.js 15 project (latest stable, not 16 which is canary) with App Router:
- Use `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"`
- Install additional dependencies:
  - `@prisma/client prisma` for database
  - `zod` for validation
  - `zustand` for client state
  - `@anthropic-ai/sdk` for Haiku API (Phase 1 feedback feature)
- Create `.env.example` with placeholders for DATABASE_URL and ANTHROPIC_API_KEY
- Create `.env.local` with same structure (user will fill in values)
- Update tailwind.config.ts to include DigiCrazy Lab colors:
  - Primary blue: #1e3a5f (dark blue)
  - Accent green: #4ade80 (bright green)
  - Add to theme.extend.colors as `brand: { blue, green }`
- Update globals.css with base font (Inter or system-ui) and Italian-friendly typography
  </action>
  <verify>
Run `npm run dev` - should start on localhost:3000 with default Next.js page.
Run `npx prisma --version` - should show Prisma CLI version.
  </verify>
  <done>
Next.js runs locally, all dependencies installed, Tailwind configured with brand colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Prisma schema with flexible question model</name>
  <files>
    prisma/schema.prisma
    src/lib/db.ts
    src/types/quiz.ts
  </files>
  <action>
Create Prisma schema following research architecture guidance (JSONB for flexibility):

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Question types as enum
enum QuestionType {
  SINGLE_CHOICE    // Radio buttons - select one
  MULTIPLE_CHOICE  // Checkboxes - select many
  YES_NO           // True/false style
  TEXT             // Open text input
  RANKING          // Drag to rank items
  PROFILE_SELECT   // Special: select one profile description
}

// Survey/Quiz definition
model Survey {
  id          String     @id @default(cuid())
  title       String
  description String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  questions   Question[]
  sessions    Session[]
}

// Question definition - uses Json for flexible options
model Question {
  id            String       @id @default(cuid())
  surveyId      String
  survey        Survey       @relation(fields: [surveyId], references: [id])
  order         Int          // Display order
  type          QuestionType
  text          String       // Question text (Italian)
  description   String?      // Optional helper text
  options       Json?        // JSONB: array of {id, label, value, nextQuestionId?}
  isRequired    Boolean      @default(true)
  // Branching: null means next in order, otherwise jump to specific question
  nextQuestionId String?
  // Conditional display: only show if condition met
  showCondition Json?        // {questionId, operator, value}
  createdAt     DateTime     @default(now())
  answers       Answer[]

  @@index([surveyId, order])
}

// User session (anonymous - no auth required)
model Session {
  id           String    @id @default(cuid())
  surveyId     String
  survey       Survey    @relation(fields: [surveyId], references: [id])
  resumeToken  String    @unique @default(cuid()) // For resume link
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  currentIndex Int       @default(0) // Track progress
  answers      Answer[]
  feedback     String?   // AI-generated feedback stored here

  @@index([resumeToken])
  @@index([surveyId])
}

// Individual answer
model Answer {
  id         String   @id @default(cuid())
  sessionId  String
  session    Session  @relation(fields: [sessionId], references: [id])
  questionId String
  question   Question @relation(fields: [questionId], references: [id])
  value      Json     // JSONB: flexible answer storage
  answeredAt DateTime @default(now())

  @@unique([sessionId, questionId]) // One answer per question per session
  @@index([sessionId])
}
```

Create `src/lib/db.ts` with Prisma client singleton pattern:
```typescript
import { PrismaClient } from '@prisma/client'

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined
}

export const prisma = globalForPrisma.prisma ?? new PrismaClient()

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
```

Create `src/types/quiz.ts` with TypeScript types that mirror schema:
- Export Question, QuestionType, Answer, Session types
- Include QuestionOption type for the Json options field
- Include ShowCondition type for conditional logic
- Add utility types: QuestionWithOptions, SessionWithAnswers

Run `npx prisma generate` to generate client.
Do NOT run prisma db push yet - user needs to configure DATABASE_URL first.
  </action>
  <verify>
Run `npx prisma validate` - should pass with no errors.
Run `npx tsc --noEmit` - TypeScript should compile without errors.
Check that `src/types/quiz.ts` exports are importable.
  </verify>
  <done>
Schema validated, Prisma client generated, TypeScript types defined and exported.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts Next.js on localhost:3000
2. `npx prisma validate` passes
3. `npx tsc --noEmit` compiles without TypeScript errors
4. `.env.example` contains DATABASE_URL and ANTHROPIC_API_KEY placeholders
5. Tailwind brand colors (blue/green) available in config
</verification>

<success_criteria>
- Next.js 15 project running locally
- Prisma schema valid with Question, Session, Answer models
- JSONB fields for flexible options and answers
- TypeScript types match schema structure
- Brand colors configured in Tailwind
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-assessment-core/01-01-SUMMARY.md`
</output>
