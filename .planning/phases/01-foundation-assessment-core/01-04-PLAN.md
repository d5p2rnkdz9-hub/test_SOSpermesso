---
phase: 01-foundation-assessment-core
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified:
  - src/app/api/feedback/route.ts
  - src/app/quiz/results/page.tsx
  - src/components/quiz/FeedbackDisplay.tsx
  - src/components/quiz/StartScreen.tsx
  - src/app/quiz/page.tsx
  - src/app/page.tsx
autonomous: false
user_setup:
  - service: anthropic
    why: "Claude Haiku API for personalized feedback generation"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "console.anthropic.com -> API Keys -> Create Key"

must_haves:
  truths:
    - "User sees branded start screen before quiz"
    - "User receives AI-generated personalized feedback after completion"
    - "Feedback references user's specific answers"
    - "Feedback is in Italian"
    - "Start and results screens show DigiCrazy Lab logo"
  artifacts:
    - path: "src/app/api/feedback/route.ts"
      provides: "Haiku feedback generation endpoint"
      exports: ["POST"]
    - path: "src/app/quiz/results/page.tsx"
      provides: "Results display page"
      min_lines: 30
    - path: "src/components/quiz/FeedbackDisplay.tsx"
      provides: "Feedback rendering component"
      exports: ["FeedbackDisplay"]
    - path: "src/components/quiz/StartScreen.tsx"
      provides: "Quiz intro screen"
      exports: ["StartScreen"]
  key_links:
    - from: "src/app/quiz/results/page.tsx"
      to: "/api/feedback"
      via: "fetch to generate feedback"
      pattern: "fetch.*api/feedback"
    - from: "src/app/api/feedback/route.ts"
      to: "@anthropic-ai/sdk"
      via: "Anthropic client"
      pattern: "Anthropic|claude"
---

<objective>
Add start screen, Haiku-powered personalized feedback, and results display to complete the end-to-end quiz experience.

Purpose: The feedback is the "wow moment" - showing Italian lawyers what AI can do by generating personalized, relevant feedback based on their actual answers. This demonstrates AI capability while providing genuine value.

Output: Complete quiz experience from branded start to personalized AI feedback.
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-assessment-core/01-CONTEXT.md
@.planning/phases/01-foundation-assessment-core/01-03-SUMMARY.md
@src/store/quiz-store.ts
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Haiku feedback API and results page</name>
  <files>
    src/app/api/feedback/route.ts
    src/app/quiz/results/page.tsx
    src/components/quiz/FeedbackDisplay.tsx
  </files>
  <action>
**src/app/api/feedback/route.ts** - Generate personalized feedback:

```typescript
import Anthropic from '@anthropic-ai/sdk'
import { prisma } from '@/lib/db'

// POST /api/feedback
// Body: { sessionId: string }
// Returns: { feedback: string }
```

Implementation:
1. Fetch session with all answers and questions from database
2. Build context from answers:
   - Which AI tools they've used (Q1)
   - Whether they use AI for work and how (Q2 + branches)
   - Their tech comfort level (Q3 profile)
   - What they hope to learn (Q4)
   - Their concerns (Q5)
   - Desired use cases (Q6)

3. Call Claude Haiku (claude-3-haiku-20240307) with prompt:

```
Sei un assistente per un corso di formazione sull'AI per avvocati italiani.

Basandoti sulle risposte del questionario di pre-valutazione, genera un feedback personalizzato in italiano.

Il feedback deve:
- Essere incoraggiante e professionale
- Riconoscere il loro attuale livello di esperienza con l'AI
- Collegare le loro aspettative (domanda 4) con cosa impareranno nel corso
- Affrontare brevemente le loro preoccupazioni (domanda 5) rassicurandoli
- Suggerire 2-3 aree specifiche su cui concentrarsi durante il corso
- Essere lungo circa 200-300 parole
- NON assegnare un "livello" - questo verra fatto nel modulo successivo

Risposte del partecipante:
{formatted answers with question text}

Genera il feedback:
```

4. Save feedback to Session.feedback field
5. Mark session as completed (Session.completedAt = now())
6. Return feedback text

Handle errors:
- If ANTHROPIC_API_KEY missing, return error message
- If API fails, return graceful fallback message in Italian

**src/components/quiz/FeedbackDisplay.tsx**:
- Receives feedback string
- Renders with nice typography
- Card-style container with brand styling
- Optional "Scarica PDF" button (stretch - can be placeholder)

**src/app/quiz/results/page.tsx**:
- Gets resumeToken from URL params or localStorage
- Fetches session to check completion status
- If not complete, redirects to /quiz
- If feedback not yet generated, calls /api/feedback
- Shows loading state while generating ("Stiamo preparando il tuo feedback personalizzato...")
- Displays FeedbackDisplay component
- Shows "Grazie per aver completato il questionario!" header
- DigiCrazy Lab logo at top
- Optional: "Condividi" or "Torna alla home" buttons
  </action>
  <verify>
1. Complete quiz flow (all questions answered)
2. On completion, redirects to /quiz/results
3. Results page shows loading state briefly
4. Personalized feedback appears in Italian
5. Feedback references specific answers (mentions tools they selected, addresses their concerns)
6. Session marked as completed in database
7. Returning to /quiz/results shows saved feedback (doesn't regenerate)
  </verify>
  <done>
Haiku API generates personalized Italian feedback, results page displays it beautifully, feedback persists in database.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create start screen and polish home page</name>
  <files>
    src/components/quiz/StartScreen.tsx
    src/app/quiz/page.tsx
    src/app/page.tsx
    public/logo.svg
  </files>
  <action>
**public/logo.svg** - Create or add DigiCrazy Lab logo:
- If actual logo file available in project docs, use that
- Otherwise create placeholder SVG with "DigiCrazy Lab" text styled
- Blue/green color scheme matching brand

**src/components/quiz/StartScreen.tsx**:
```typescript
interface StartScreenProps {
  onStart: () => void
  isLoading?: boolean
}
```
- DigiCrazy Lab logo prominently displayed
- Course title: "AI e professione forense"
- Tagline: "TrAIn your BrAIn" (from brochure)
- Brief intro text explaining what this questionnaire is for (Italian):
  "Questo breve questionario ci aiutera a personalizzare il corso in base alla tua esperienza e alle tue aspettative. Richiede circa 5 minuti."
- Large "Inizia" button (brand-blue)
- Privacy note: "Le tue risposte sono riservate e saranno utilizzate solo per migliorare la tua esperienza formativa."
- Clean, welcoming design - NOT test-like

**src/app/quiz/page.tsx** - Update to show StartScreen:
- Check if session exists (resumeToken in localStorage or URL)
- If no session: show StartScreen
- If session exists but not complete: show QuizPlayer (resume)
- If session complete: redirect to /quiz/results
- StartScreen onStart creates new session and shows QuizPlayer

**src/app/page.tsx** - Landing page:
- Redirect to /quiz for now (single-purpose app)
- Or: Simple landing with "Inizia il questionario" button linking to /quiz
  </action>
  <verify>
1. Visit localhost:3000 - see landing or redirect to /quiz
2. /quiz shows StartScreen with logo and intro
3. Click "Inizia" - quiz begins
4. Complete quiz - see personalized feedback
5. Return to /quiz after completion - redirects to results (doesn't restart)
6. Clear localStorage, return to /quiz - shows StartScreen again
  </verify>
  <done>
Complete end-to-end flow: branded start screen -> quiz questions -> personalized AI feedback. Logo visible on start and results screens only.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 1 quiz experience: start screen, all question types, branching logic, session persistence, AI-generated Italian feedback</what-built>
  <how-to-verify>
1. Open localhost:3000/quiz in fresh browser (or incognito)
2. Verify start screen shows DigiCrazy Lab branding and Italian intro text
3. Click "Inizia" - first question appears
4. Answer Q1 (select some AI tools)
5. Answer Q2 "Si" - verify Q2a, Q2b, Q2c appear next
6. Complete remaining questions
7. Verify results page shows personalized feedback that:
   - Is in Italian
   - References your specific answers (tools selected, concerns mentioned)
   - Feels encouraging and professional
8. Refresh results page - feedback should persist (not regenerate)
9. Test resume: Start new quiz, answer 3 questions, close browser, reopen - should resume at Q4
10. Test No branch: New session, answer Q2 "No" - should see Q2d instead of Q2a/b/c
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Start screen displays with logo and Italian text
2. Quiz flows through all questions correctly
3. Branching works (Q2 Yes/No paths)
4. Session persists across refresh
5. AI feedback generates and displays in Italian
6. Feedback is personalized (references actual answers)
7. Visual design matches DigiCrazy Lab branding (blue/green)
8. All text is in Italian
</verification>

<success_criteria>
- Complete user journey from start to personalized feedback
- AI feedback demonstrates Claude capability to lawyers
- Branded experience (DigiCrazy Lab)
- Session persistence allows resume
- All requirements ASMNT-01 through ASMNT-05 met
- Ready for user testing before Feb 25 course
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-assessment-core/01-04-SUMMARY.md`
</output>
