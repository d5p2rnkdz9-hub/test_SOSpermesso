---
phase: 01-i18n-foundation-design-system
plan: 03
type: execute
wave: 2
depends_on: [01, 02]
files_modified:
  - src/components/layout/StickyHeader.tsx
  - src/components/layout/LanguageSelector.tsx
  - src/components/layout/ContentColumn.tsx
  - src/app/[locale]/layout.tsx
  - src/app/[locale]/page.tsx
autonomous: false

must_haves:
  truths:
    - "Every page has a sticky header with SOSpermesso logo (inline-start), back button, and language selector (inline-end)"
    - "Language selector shows language names in native script (Italiano, العربية, Français, English, Español) -- no flags"
    - "Switching language via the selector changes the URL locale prefix and re-renders the page in the new language without full page reload"
    - "Content is constrained to a centered narrow column (max-width ~520px) on all screen sizes"
    - "Welcome page shows: logo/title, one line explanation, big Start button -- all in the current locale's language"
    - "On a 320px mobile screen, all interactive elements have 48px+ touch targets and content is readable without horizontal scrolling"
    - "Switching to /ar/ shows the entire layout mirrored: logo on right, language selector on left, text right-aligned"
  artifacts:
    - path: "src/components/layout/StickyHeader.tsx"
      provides: "Sticky header with logo, back button, language selector"
      min_lines: 20
    - path: "src/components/layout/LanguageSelector.tsx"
      provides: "Locale-switching dropdown with native script names"
      contains: "useRouter"
    - path: "src/components/layout/ContentColumn.tsx"
      provides: "Centered narrow content column"
      contains: "max-w"
    - path: "src/app/[locale]/page.tsx"
      provides: "Welcome/start screen with translated content"
      contains: "useTranslations"
  key_links:
    - from: "src/components/layout/LanguageSelector.tsx"
      to: "src/i18n/navigation.ts"
      via: "useRouter for locale-aware navigation"
      pattern: "useRouter|usePathname"
    - from: "src/components/layout/LanguageSelector.tsx"
      to: "src/i18n/routing.ts"
      via: "routing.locales for available languages"
      pattern: "routing\\.locales"
    - from: "src/components/layout/StickyHeader.tsx"
      to: "src/components/layout/LanguageSelector.tsx"
      via: "imports and renders LanguageSelector"
      pattern: "LanguageSelector"
    - from: "src/app/[locale]/layout.tsx"
      to: "src/components/layout/StickyHeader.tsx"
      via: "renders header in locale layout"
      pattern: "StickyHeader"
    - from: "src/app/[locale]/page.tsx"
      to: "messages/*.json"
      via: "useTranslations loads welcome strings"
      pattern: "useTranslations"
---

<objective>
Build the layout shell (StickyHeader, LanguageSelector, ContentColumn) and the welcome/start screen page, then verify the complete Phase 1 deliverable works correctly in both LTR and RTL modes on mobile. This plan brings together the i18n infrastructure (Plan 01) and the visual identity (Plan 02) into a usable, testable application.

Purpose: This is the integration plan that turns infrastructure into a visible, testable product. The layout components define the application's physical structure, and the welcome page proves the entire Phase 1 stack works end-to-end: locale routing, RTL direction, translated content, yellow/black design, and mobile-first layout.
Output: Functional welcome page at /{locale}/ with sticky header, language selector, narrow content column, and all Phase 1 success criteria verifiable.
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-i18n-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-i18n-foundation-design-system/01-CONTEXT.md
@.planning/phases/01-i18n-foundation-design-system/01-01-SUMMARY.md
@.planning/phases/01-i18n-foundation-design-system/01-02-SUMMARY.md

Key files from prior plans:
@src/i18n/routing.ts (Plan 01 -- routing config)
@src/i18n/navigation.ts (Plan 01 -- locale-aware Link, useRouter, usePathname)
@src/app/[locale]/layout.tsx (Plan 01 -- locale layout with providers)
@src/app/globals.css (Plan 02 -- yellow/black/white tokens, slide transitions)
@src/components/ui/button.tsx (Plan 02 -- updated button variants and sizes)
@messages/it.json (Plan 01 -- Italian UI strings)
@messages/ar.json (Plan 01 -- Arabic UI strings)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build layout components (StickyHeader, LanguageSelector, ContentColumn)</name>
  <files>
    src/components/layout/StickyHeader.tsx
    src/components/layout/LanguageSelector.tsx
    src/components/layout/ContentColumn.tsx
    src/app/[locale]/layout.tsx
  </files>
  <action>
    1. Create `src/components/layout/LanguageSelector.tsx`:
       - Client component (`'use client'`)
       - Uses `useLocale()` from next-intl to get current locale
       - Uses `useRouter()` and `usePathname()` from `@/i18n/navigation` for soft locale switching
       - Uses `routing.locales` from `@/i18n/routing` for available locales
       - Displays language names in native script using a constant map:
         ```
         it -> "Italiano"
         ar -> "العربية"
         fr -> "Français"
         en -> "English"
         es -> "Español"
         ```
       - On change, calls `router.replace(pathname, { locale: newLocale })` for soft navigation (preserves scroll/state)
       - Renders as a `<select>` dropdown (simple, accessible, works on all mobile browsers)
       - Styling: transparent background, black border, rounded-md, min-h-[48px] for touch target, text-sm
       - NO flags -- text only, per design decision
       - Uses logical properties only (no ml-, mr-)

    2. Create `src/components/layout/StickyHeader.tsx`:
       - Client component (`'use client'`) because it imports LanguageSelector (which is client)
       - Actually -- make StickyHeader a server component that renders LanguageSelector as a client island. OR make the whole thing a client component for simplicity. Given the header is small, client component is fine.
       - Structure:
         ```
         <header> (sticky top-0 z-50 w-full border-b border-border bg-background)
           <div> (mx-auto flex h-14 max-w-[520px] items-center justify-between px-4)
             {/* Logo - inline start (automatically left in LTR, right in RTL via flexbox) */}
             <a href="https://sospermesso.it" target="_blank" rel="noopener noreferrer">
               SOSpermesso text logo (or SVG if available -- for Phase 1, use text: "SOSpermesso" in bold)
             </a>

             {/* Language selector - inline end (automatically right in LTR, left in RTL via flexbox) */}
             <LanguageSelector />
           </div>
         </header>
         ```
       - The logo links to sospermesso.it. Per design decision, it should link to the matching language page. For now, link to `https://sospermesso.it` (language-specific linking is a Phase 3+ concern).
       - Back button is NOT shown on the welcome page (first screen). It will be added in Phase 2 when tree navigation exists. For Phase 1, the header has logo + language selector only.
       - The `justify-between` on flexbox + `dir="rtl"` on html automatically mirrors the layout in RTL mode. No explicit RTL classes needed.
       - Touch target: header height h-14 (56px) ensures all header elements have adequate touch area.

    3. Create `src/components/layout/ContentColumn.tsx`:
       - Server component (no client interactivity needed)
       - Simple wrapper:
         ```tsx
         export function ContentColumn({ children }: { children: React.ReactNode }) {
           return (
             <main className="mx-auto w-full max-w-[520px] px-4 py-6">
               {children}
             </main>
           );
         }
         ```
       - max-w-[520px] constrains content on all screen sizes
       - px-4 (16px) horizontal padding on mobile
       - py-6 (24px) vertical padding
       - mx-auto centers the column

    4. Update `src/app/[locale]/layout.tsx` to include StickyHeader in the layout:
       - Import StickyHeader
       - Render it INSIDE the body, ABOVE children:
         ```tsx
         <body className={...}>
           <DirectionProvider dir={dir}>
             <NextIntlClientProvider>
               <StickyHeader />
               {children}
             </NextIntlClientProvider>
           </DirectionProvider>
         </body>
         ```
       - Do NOT wrap children in ContentColumn at the layout level -- let individual pages decide their layout. The welcome page will use ContentColumn.

    IMPORTANT: All components must use ONLY logical CSS properties. No ml-, mr-, pl-, pr-, text-left, text-right, left-, right-.
    IMPORTANT: All interactive elements must have min-h-[48px] or equivalent for touch targets.
  </action>
  <verify>
    1. `ls src/components/layout/` shows StickyHeader.tsx, LanguageSelector.tsx, ContentColumn.tsx
    2. `grep -c 'ml-\|mr-\|pl-\|pr-\|text-left\|text-right' src/components/layout/*.tsx` returns 0
    3. `npm run build` succeeds
    4. `npm run dev` -- navigate to /it/ -- header appears with "SOSpermesso" on left and language dropdown on right
    5. Navigate to /ar/ -- header mirrors: "SOSpermesso" on right, language dropdown on left (automatic via flexbox + dir=rtl)
    6. Change language in dropdown -- URL updates, page re-renders in new language
  </verify>
  <done>
    StickyHeader, LanguageSelector, ContentColumn created. Header renders in locale layout. Language switching works via soft navigation. Layout mirrors correctly in RTL. All components use logical properties only. All interactive elements meet 48px touch target.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build welcome/start page with translated content</name>
  <files>
    src/app/[locale]/page.tsx
  </files>
  <action>
    Replace the placeholder `src/app/[locale]/page.tsx` with the actual welcome/start screen.

    Per design decisions:
    - Welcome screen: minimal -- logo, one line explanation, big "Start" button
    - Large, generous text sizing -- calming, impossible to miss
    - Yellow background (inherited from body/background)
    - Black text on yellow
    - Start button: black background, yellow text (primary variant from button.tsx)

    Implementation:
    ```tsx
    import { useTranslations } from 'next-intl';
    import { setRequestLocale } from 'next-intl/server';
    import { ContentColumn } from '@/components/layout/ContentColumn';
    import { Button } from '@/components/ui/button';
    import { Link } from '@/i18n/navigation';

    type Props = {
      params: Promise<{ locale: string }>;
    };

    export default async function WelcomePage({ params }: Props) {
      const { locale } = await params;
      setRequestLocale(locale);

      return <WelcomeContent />;
    }

    // Separate client component for useTranslations (or use server component with getTranslations)
    // Actually, useTranslations works in Server Components in next-intl v4.
    // Let's keep it as a server component using the server API.
    ```

    Actually, in next-intl v4, `useTranslations` works in BOTH server and client components. For a static page like the welcome screen, keep it as a server component.

    The welcome page structure:
    ```
    <ContentColumn>
      <div className="flex min-h-[calc(100vh-3.5rem)] flex-col items-center justify-center text-center">
        {/* Large title */}
        <h1 className="text-4xl font-bold leading-tight sm:text-5xl">
          {t('welcome.title')}
        </h1>

        {/* Subtitle */}
        <p className="mt-4 text-lg text-foreground/80">
          {t('welcome.subtitle')}
        </p>

        {/* Big Start button */}
        <Button size="lg" className="mt-8 w-full text-lg font-semibold" asChild>
          <Link href="/tree">{t('welcome.start')}</Link>
        </Button>
        {/* Note: /tree doesn't exist yet (Phase 2). For Phase 1, the link can point to "#" or "/tree" -- it will 404 which is fine for now. */}

        {/* Disclaimer */}
        <p className="mt-6 text-sm text-foreground/60">
          {t('welcome.disclaimer')}
        </p>
      </div>
    </ContentColumn>
    ```

    Key styling notes:
    - `min-h-[calc(100vh-3.5rem)]` accounts for the 56px (3.5rem) sticky header
    - Vertically centered content -- the welcome screen should feel spacious and calming
    - Title is text-4xl on mobile, text-5xl on larger screens -- large and generous per design
    - Start button uses `size="lg"` (h-14 = 56px touch target) and `w-full` for easy tapping
    - `text-foreground/80` and `text-foreground/60` for subtitle and disclaimer -- uses opacity on black (not gray) to maintain contrast on yellow background per accessibility rules from research
    - The Link component uses next-intl's locale-aware Link, so it will automatically prepend the locale prefix

    IMPORTANT: The Start button's `href="/tree"` will produce a working link at `/{locale}/tree`. This page doesn't exist yet (Phase 2), so clicking it will show the not-found page. This is expected and acceptable for Phase 1.

    IMPORTANT: Do NOT use `text-muted-foreground` for text on yellow background -- the muted foreground color (dark gray, 30%) on yellow may fail contrast checks. Use `text-foreground/80` (black at 80% opacity) instead.
  </action>
  <verify>
    1. `npm run dev` -- navigate to /it/ -- welcome page shows:
       - Italian title "Verifica il tuo diritto al permesso di soggiorno"
       - Italian subtitle
       - "Inizia la verifica" button (black background, yellow text)
       - Disclaimer text
    2. Navigate to /ar/ -- welcome page shows:
       - Arabic title (right-to-left text)
       - Arabic subtitle
       - Arabic start button
       - All text is right-aligned (automatic via dir=rtl)
       - Layout is mirrored
    3. Navigate to /en/ -- shows English content
    4. Navigate to /fr/ -- shows French content
    5. Navigate to /es/ -- shows Spanish content
    6. On mobile viewport (320px width in DevTools):
       - Content is readable without horizontal scrolling
       - Start button spans full width, 48px+ height
       - No text overflow
    7. `npm run build` succeeds
  </verify>
  <done>
    Welcome page renders translated content in all 5 locales. Layout centers content vertically in narrow column. Start button has 48px+ touch target. Arabic content displays RTL. Mobile viewport (320px) shows no horizontal scroll and readable content.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 deliverable: i18n routing with 5 locales, SOSpermesso yellow/black/white visual identity, RTL-safe components, sticky header with language selector, and welcome/start page -- all rendering correctly in both LTR and RTL modes.
  </what-built>
  <how-to-verify>
    Start the dev server: `npm run dev`

    **1. Visual Identity Check (Success Criteria #2)**
    - Open http://localhost:3000/it/
    - Verify: Yellow (#FFC629) dominant background, black text, white elements
    - Verify: NO blue, green, or Corso AI colors visible anywhere
    - Verify: NO shadows on any element (flat design, elements defined by borders)
    - Verify: Rounded corners (12px) on interactive elements
    - Verify: "SOSpermesso" in header, not "Corso AI" or "DigiCrazy"

    **2. RTL/LTR Check (Success Criteria #1)**
    - Open http://localhost:3000/it/ -- verify LTR layout: logo on left, language selector on right, text left-aligned
    - Switch to Arabic using language selector
    - Verify URL changes to /ar/
    - Verify: ENTIRE layout mirrors -- logo on right, language selector on left, text right-aligned
    - Verify: Arabic text renders in Arabic font (not Latin fallback)
    - Verify: All content is translated to Arabic
    - Switch back to Italian -- verify layout returns to LTR

    **3. Mobile Check (Success Criteria #3)**
    - Open Chrome DevTools, set viewport to 320px width (iPhone SE)
    - On /it/: Verify content is readable, no horizontal scrolling
    - Verify Start button is full-width and tall (48px+ height)
    - Verify header elements are tappable (not cramped)
    - On /ar/: Same checks in RTL mode

    **4. Language Switching Check**
    - On any page, switch between all 5 languages using the selector
    - Verify each language shows translated content
    - Verify no "missing translation" warnings in browser console
    - Verify switching is smooth (no full page reload flash)

    **5. Physical CSS Audit (Success Criteria #4)**
    - In terminal, run: `grep -rn 'ml-\|mr-\|text-left\|text-right' src/ --include="*.tsx"`
    - Verify: ZERO results (or only false positives)
  </how-to-verify>
  <resume-signal>Type "approved" if everything looks correct, or describe specific issues to fix.</resume-signal>
</task>

</tasks>

<verification>
Phase 1 success criteria verification:

1. **LTR/RTL rendering:** /it/ shows LTR, /ar/ shows RTL -- text alignment, spacing, and component layout all flip appropriately
2. **Visual identity:** Yellow/black/white SOSpermesso design -- not Corso AI blue/green
3. **Mobile 320px:** Content readable, no horizontal scroll, 48px+ touch targets on interactive elements
4. **Zero physical CSS:** `grep -rn 'ml-\|mr-\|pl-\|pr-\|text-left\|text-right\|border-l-\|border-r-' src/ --include="*.tsx" --include="*.ts"` returns 0 results
5. **Build passes:** `npm run build` exits 0
</verification>

<success_criteria>
- Sticky header appears on all pages with logo and language selector
- Language selector shows native script names and switches locale via soft navigation
- Content is centered in narrow column (max-width 520px)
- Welcome page shows translated content in all 5 locales
- Arabic layout is fully mirrored (RTL)
- Mobile viewport (320px) has no horizontal scroll and 48px+ touch targets
- Human verification of visual identity, RTL rendering, and mobile layout passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-i18n-foundation-design-system/01-03-SUMMARY.md`
</output>
